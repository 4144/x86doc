<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8"/>
	<link rel="stylesheet" type="text/css" href="style.css"/>
	<title>CLI — Clear Interrupt Flag</title>
</head>
<body>
<h1 id="cli-clear-interrupt-flag">CLI — Clear Interrupt Flag</h1>
<table>
<tr>
	<td>Opcode</td>
	<td>Instruction</td>
	<td>Op/En</td>
	<td>64-bit Mode</td>
	<td>Compat/Leg Mode</td>
	<td>Description</td>
</tr>
<tr>
	<td>FA</td>
	<td>CLI</td>
	<td>NP</td>
	<td>Valid</td>
	<td>Valid</td>
	<td>Clear interrupt flag; interrupts disabled when interrupt flag cleared.</td>
</tr>
</table>
<h2 id="instruction-operand-encoding">Instruction Operand Encoding</h2>
<table>
<tr>
	<td>Op/En</td>
	<td>Operand 1</td>
	<td>Operand 2</td>
	<td>Operand 3</td>
	<td>Operand 4</td>
</tr>
<tr>
	<td>NP</td>
	<td>NA</td>
	<td>NA</td>
	<td>NA</td>
	<td>NA</td>
</tr>
</table>
<h2 id="description">Description</h2>
<p>If protected-mode virtual interrupts are not enabled, CLI clears the IF flag in the EFLAGS register. No other flags are affected. Clearing the IF flag causes the processor to ignore maskable external interrupts. The IF flag and the CLI and STI instruction have no affect on the generation of exceptions and NMI interrupts.</p>
<p>When protected-mode virtual interrupts are enabled, CPL is 3, and IOPL is less than 3; CLI clears the VIF flag in the EFLAGS register, leaving IF unaffected. Table 3-6 indicates the action of the CLI instruction depending on the processor operating mode and the CPL/IOPL of the running program or procedure.</p>
<p>CLI operation is the same in non-64-bit modes and 64-bit mode.</p>
<h3 id="table-3-6-decision-table-for-cli-results">Table 3-6. Decision Table for CLI Results</h3>
<table>
<tr>
	<td>PE</td>
	<td>VM</td>
	<td>IOPL</td>
	<td>CPL</td>
	<td>PVI</td>
	<td>VIP</td>
	<td>VME</td>
	<td>CLI Result</td>
</tr>
<tr>
	<td>0</td>
	<td>X</td>
	<td>X</td>
	<td>X</td>
	<td>X</td>
	<td>X</td>
	<td>X</td>
	<td>IF = 0</td>
</tr>
<tr>
	<td>1</td>
	<td>0</td>
	<td>≥ CPL</td>
	<td>X</td>
	<td>X</td>
	<td>X</td>
	<td>X</td>
	<td>IF = 0</td>
</tr>
<tr>
	<td>1</td>
	<td>0</td>
	<td>&lt; CPL</td>
	<td>3</td>
	<td>1</td>
	<td>X</td>
	<td>X</td>
	<td>VIF = 0</td>
</tr>
<tr>
	<td>1</td>
	<td>0</td>
	<td>&lt; CPL</td>
	<td>&lt; 3</td>
	<td>X</td>
	<td>X</td>
	<td>X</td>
	<td>GP Fault</td>
</tr>
<tr>
	<td>1</td>
	<td>0</td>
	<td>&lt; CPL</td>
	<td>X</td>
	<td>0</td>
	<td>X</td>
	<td>X</td>
	<td>GP Fault</td>
</tr>
<tr>
	<td>1</td>
	<td>1</td>
	<td>3</td>
	<td>X</td>
	<td>X</td>
	<td>X</td>
	<td>X</td>
	<td>IF = 0</td>
</tr>
<tr>
	<td>1</td>
	<td>1</td>
	<td>&lt; 3</td>
	<td>X</td>
	<td>X</td>
	<td>X</td>
	<td>1</td>
	<td>VIF = 0</td>
</tr>
<tr>
	<td>1</td>
	<td>1</td>
	<td>&lt; 3</td>
	<td>X</td>
	<td>X</td>
	<td>X</td>
	<td>0</td>
	<td>GP Fault</td>
</tr>
</table>
<p class="notes">Notes: * X = This setting has no impact.</p>
<h2 id="operation">Operation</h2>
<pre>IF PE = 0
  THEN
     IF ← 0; (* Reset Interrupt Flag *)
  ELSE
     IF VM = 0;
       THEN
          IF IOPL ≥ CPL
             THEN
               IF ← 0; (* Reset Interrupt Flag *)
          ELSE
             IF ((IOPL &lt; CPL) and (CPL = 3) and (PVI = 1))
               THEN
                  VIF ← 0; (* Reset Virtual Interrupt Flag *)
               ELSE
                  #GP(0);
             FI;
          FI;
       ELSE (* VM = 1 *)
          IF IOPL = 3
             THEN
               IF ← 0; (* Reset Interrupt Flag *)
             ELSE
               IF (IOPL &lt; 3) AND (VME = 1)
                  THEN
                     VIF ← 0; (* Reset Virtual Interrupt Flag *)
                  ELSE
                     #GP(0);
               FI;
          FI;
     FI;
FI;
</pre>
<h2 id="flags-affected">Flags Affected</h2>
<p>If protected-mode virtual interrupts are not enabled, IF is set to 0 if the CPL is equal to or less than the IOPL; otherwise, it is not affected. The other flags in the EFLAGS register are unaffected.</p>
<p>When protected-mode virtual interrupts are enabled, CPL is 3, and IOPL is less than 3; CLI clears the VIF flag in the EFLAGS register, leaving IF unaffected.</p>
<h2 id="protected-mode-exceptions">Protected Mode Exceptions</h2>
<table>
<tr>
	<td>#GP(0)</td>
	<td>If the CPL is greater (has less privilege) than the IOPL of the current program or procedure.</td>
</tr>
<tr>
	<td>#UD</td>
	<td>If the LOCK prefix is used.</td>
</tr>
</table>
<h2 id="real-address-mode-exceptions">Real-Address Mode Exceptions</h2>
<table>
<tr>
	<td>#UD</td>
	<td>If the LOCK prefix is used.</td>
</tr>
</table>
<h2 id="virtual-8086-mode-exceptions">Virtual-8086 Mode Exceptions</h2>
<table>
<tr>
	<td>#GP(0)</td>
	<td>If the CPL is greater (has less privilege) than the IOPL of the current program or procedure.</td>
</tr>
<tr>
	<td>#UD</td>
	<td>If the LOCK prefix is used.</td>
</tr>
</table>
<h2 id="compatibility-mode-exceptions">Compatibility Mode Exceptions</h2>
<p>Same exceptions as in protected mode.</p>
<h2 id="64-bit-mode-exceptions">64-Bit Mode Exceptions</h2>
<table>
<tr>
	<td>#GP(0)</td>
	<td>If the CPL is greater (has less privilege) than the IOPL of the current program or procedure.</td>
</tr>
<tr>
	<td>#UD</td>
	<td>If the LOCK prefix is used.</td>
</tr>
</table>
</body>
</html>
